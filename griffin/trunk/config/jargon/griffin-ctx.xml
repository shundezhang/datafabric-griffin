<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

	<bean id="cmdAbor" class="au.org.arcs.griffin.cmd.impl.FtpCmdAbor" singleton="false" />
	<bean id="cmdAllo" class="au.org.arcs.griffin.cmd.impl.FtpCmdAllo" singleton="false" />
	<bean id="cmdAppe" class="au.org.arcs.griffin.cmd.impl.FtpCmdAppe" singleton="false" />
	<bean id="cmdAuth" class="au.org.arcs.griffin.cmd.impl.FtpCmdAuthGSI" singleton="false" />
	<bean id="cmdAdat" class="au.org.arcs.griffin.cmd.impl.FtpCmdAdat" singleton="false" />
	<bean id="cmdCdup" class="au.org.arcs.griffin.cmd.impl.FtpCmdCdup" singleton="false" />
	<bean id="cmdCksm" class="au.org.arcs.griffin.cmd.impl.FtpCmdCksm" singleton="false" />
	<bean id="cmdClnt" class="au.org.arcs.griffin.cmd.impl.FtpCmdClnt" singleton="false" />
	<bean id="cmdCwd" class="au.org.arcs.griffin.cmd.impl.FtpCmdCwd" singleton="false" />
	<bean id="cmdCcc" class="au.org.arcs.griffin.cmd.impl.FtpCmdCcc" singleton="false" />
	<bean id="cmdDcau" class="au.org.arcs.griffin.cmd.impl.FtpCmdDcau" singleton="false" />
	<bean id="cmdDele" class="au.org.arcs.griffin.cmd.impl.FtpCmdDele" singleton="false" />
	<bean id="cmdEnc" class="au.org.arcs.griffin.cmd.impl.FtpCmdEnc" singleton="false" />
	<bean id="cmdEprt" class="au.org.arcs.griffin.cmd.impl.FtpCmdEprt" singleton="false" />
	<bean id="cmdEpsv" class="au.org.arcs.griffin.cmd.impl.FtpCmdEpsv" singleton="false" />
	<bean id="cmdEret" class="au.org.arcs.griffin.cmd.impl.FtpCmdEret" singleton="false" />
	<bean id="cmdEsto" class="au.org.arcs.griffin.cmd.impl.FtpCmdEsto" singleton="false" />
	<bean id="cmdFeat" class="au.org.arcs.griffin.cmd.impl.FtpCmdFeat" singleton="false" />
	<bean id="cmdHelp" class="au.org.arcs.griffin.cmd.impl.FtpCmdHelp" singleton="false" />
	<bean id="cmdList" class="au.org.arcs.griffin.cmd.impl.FtpCmdList" singleton="false" />
	<bean id="cmdMkd" class="au.org.arcs.griffin.cmd.impl.FtpCmdMkd" singleton="false" />
	<bean id="cmdMdtm" class="au.org.arcs.griffin.cmd.impl.FtpCmdMdtm" singleton="false" />
	<bean id="cmdMlsd" class="au.org.arcs.griffin.cmd.impl.FtpCmdMlsd" singleton="false" />
	<bean id="cmdMlst" class="au.org.arcs.griffin.cmd.impl.FtpCmdMlst" singleton="false" />
	<bean id="cmdMode" class="au.org.arcs.griffin.cmd.impl.FtpCmdMode" singleton="false" />
	<bean id="cmdNlst" class="au.org.arcs.griffin.cmd.impl.FtpCmdNlst" singleton="false" />
	<bean id="cmdNoop" class="au.org.arcs.griffin.cmd.impl.FtpCmdNoop" singleton="false" />
	<bean id="cmdOpts" class="au.org.arcs.griffin.cmd.impl.FtpCmdOpts" singleton="false" />
	<bean id="cmdPass" class="au.org.arcs.griffin.cmd.impl.FtpCmdPassGSI" singleton="false" />
	<bean id="cmdPasv" class="au.org.arcs.griffin.cmd.impl.FtpCmdPasv" singleton="false" />
	<bean id="cmdPbsz" class="au.org.arcs.griffin.cmd.impl.FtpCmdPbsz" singleton="false" />
	<bean id="cmdPort" class="au.org.arcs.griffin.cmd.impl.FtpCmdPort" singleton="false" />
	<bean id="cmdProt" class="au.org.arcs.griffin.cmd.impl.FtpCmdProt" singleton="false" />
	<bean id="cmdPwd" class="au.org.arcs.griffin.cmd.impl.FtpCmdPwd" singleton="false" />
	<bean id="cmdQuit" class="au.org.arcs.griffin.cmd.impl.FtpCmdQuit" singleton="false" />
	<bean id="cmdRest" class="au.org.arcs.griffin.cmd.impl.FtpCmdRest" singleton="false" />
	<bean id="cmdRetr" class="au.org.arcs.griffin.cmd.impl.FtpCmdRetr" singleton="false" />
	<bean id="cmdRmd" class="au.org.arcs.griffin.cmd.impl.FtpCmdRmd" singleton="false" />
	<bean id="cmdRnfr" class="au.org.arcs.griffin.cmd.impl.FtpCmdRnfr" singleton="false" />
	<bean id="cmdRnto" class="au.org.arcs.griffin.cmd.impl.FtpCmdRnto" singleton="false" />
	<bean id="cmdSbuf" class="au.org.arcs.griffin.cmd.impl.FtpCmdSbuf" singleton="false" />
	<bean id="cmdScks" class="au.org.arcs.griffin.cmd.impl.FtpCmdScks" singleton="false" />
	<bean id="cmdSite" class="au.org.arcs.griffin.cmd.impl.FtpCmdSite" singleton="false" />
	<bean id="cmdSize" class="au.org.arcs.griffin.cmd.impl.FtpCmdSize" singleton="false" />
	<bean id="cmdSpas" class="au.org.arcs.griffin.cmd.impl.FtpCmdSpas" singleton="false" />
	<bean id="cmdSpor" class="au.org.arcs.griffin.cmd.impl.FtpCmdSpor" singleton="false" />
	<bean id="cmdStat" class="au.org.arcs.griffin.cmd.impl.FtpCmdStat" singleton="false" />
	<bean id="cmdStor" class="au.org.arcs.griffin.cmd.impl.FtpCmdStor" singleton="false" />
	<bean id="cmdStou" class="au.org.arcs.griffin.cmd.impl.FtpCmdStou" singleton="false" />
	<bean id="cmdStru" class="au.org.arcs.griffin.cmd.impl.FtpCmdStru" singleton="false" />
	<bean id="cmdSyst" class="au.org.arcs.griffin.cmd.impl.FtpCmdSyst" singleton="false" />
	<bean id="cmdType" class="au.org.arcs.griffin.cmd.impl.FtpCmdType" singleton="false" />
	<bean id="cmdUser" class="au.org.arcs.griffin.cmd.impl.FtpCmdUserGSI" singleton="false" />
	<bean id="cmdNotImpl" class="au.org.arcs.griffin.cmd.impl.FtpCmdNotImpl" singleton="false" />

	<!-- List of FTP commands that can be handled by the application.
		New commands ca be registered here.

		Note that the hash table values are bean names, hence strings. The value-ref attribute
		was not used here since we need to create a new command instance each time we access the hash table
		and cannot reuse the command prototype.
	-->
	<bean id="parser" singleton="true" class="au.org.arcs.griffin.parser.impl.FtpCmdParserImpl">
		<property name="commands">
			<map>
				<entry key="ABOR" value="cmdAbor" />
				<entry key="ACCT" value="cmdNotImpl" />
				<entry key="ADAT" value="cmdAdat" />
				<entry key="ALLO" value="cmdAllo" />
				<entry key="APPE" value="cmdAppe" />
				<entry key="AUTH" value="cmdAuth" />
				<entry key="CCC" value="cmdCcc" />
				<entry key="CKSM" value="cmdCksm" />
				<entry key="CDUP" value="cmdCdup" />
				<entry key="CLNT" value="cmdClnt" />
				<entry key="CWD" value="cmdCwd" />
				<entry key="DELE" value="cmdDele" />
				<entry key="DCAU" value="cmdDcau" />
				<entry key="ENC" value="cmdEnc" />
				<entry key="EPSV" value="cmdEpsv" />
				<entry key="EPRT" value="cmdEprt" />
				<entry key="ERET" value="cmdEret" />
				<entry key="ESTO" value="cmdEsto" />
			    <entry key="FEAT" value="cmdFeat" />
				<entry key="HELP" value="cmdHelp" />
				<entry key="LIST" value="cmdList" />
				<entry key="MKD" value="cmdMkd" />
				<entry key="MDTM" value="cmdMdtm" />
				<entry key="MLSD" value="cmdMlsd" />
				<entry key="MLST" value="cmdMlst" />
				<entry key="MODE" value="cmdMode" />
				<entry key="NLST" value="cmdNlst" />
				<entry key="NOOP" value="cmdNoop" />
				<entry key="NOP" value="cmdNoop" />
				<entry key="OPTS" value="cmdOpts" />
				<entry key="PASS" value="cmdPass" />
				<entry key="PASV" value="cmdPasv" />
				<entry key="P@SW" value="cmdNotImpl" />
				<entry key="PBSZ" value="cmdPbsz" />
				<entry key="PORT" value="cmdPort" />
				<entry key="PROT" value="cmdProt" />
				<entry key="PWD" value="cmdPwd" />
				<entry key="QUIT" value="cmdQuit" />
				<entry key="REST" value="cmdRest" />
				<entry key="RETR" value="cmdRetr" />
				<entry key="RNFR" value="cmdRnfr" />
				<entry key="RNTO" value="cmdRnto" />
				<entry key="RMD" value="cmdRmd" />
				<entry key="SBUF" value="cmdSbuf" />
				<entry key="SITE" value="cmdSite" />
				<entry key="SCKS" value="cmdScks" />
				<entry key="SIZE" value="cmdSize" />
				<entry key="SMNT" value="cmdNotImpl" />
				<entry key="SPAS" value="cmdSpas" />
				<entry key="SPOR" value="cmdSpor" />
				<entry key="STAT" value="cmdStat" />
				<entry key="STOR" value="cmdStor" />
				<entry key="STOU" value="cmdStou" />
				<entry key="STRU" value="cmdStru" />
				<entry key="SYST" value="cmdSyst" />
				<entry key="TYPE" value="cmdType" />
				<entry key="USER" value="cmdUser" />
				<entry key="XCUP" value="cmdCdup" />
				<entry key="XMKD" value="cmdMkd" />
				<entry key="XPWD" value="cmdPwd" />
				<entry key="XRMD" value="cmdRmd" />
			</map>
		</property>
	</bean>

	<bean id="options" class="au.org.arcs.griffin.server.impl.FtpServerOptionsImpl" singleton="true">
		<property name="properties">
			<props>
				<prop key="max.connections">20</prop>
				<prop key="max.idle.seconds">600</prop>
				<prop key="buffer.size">2048000</prop>
				<prop key="allowed.passive.tcp.ports">40000-41000</prop>
				<prop key="allowed.passive.udp.ports">40000-41000</prop>
				<prop key="ftp.port">2811</prop>
				<prop key="charset.ebcdic">CP1047</prop>
				<prop key="charset.ascii">ISO-8859-1</prop>
				<prop key="service.key">/etc/grid-security/hostkey.pem</prop>
				<prop key="service.cert">/etc/grid-security/hostcert.pem</prop>
				<prop key="service.trusted.certs">/etc/grid-security/certificates</prop>
			</props>
		</property>
	</bean>

	<bean id="sftpirods-options" class="au.org.arcs.sftp.config.SftpConfigProperties" singleton="true">
	    <constructor-arg>
	      <props>
	        <!-- Optional include the SFTP Server Label, overrides the Label stored in app.properties-->
	        <prop key="server.label">sFTP to iRods Server</prop>
	        <!-- Must include the SResource location-->
	        <prop key="resources.name">sftpirods-res</prop>
	        <!-- Must include the SSH host key file location-->
	        <prop key="sftp.hostkey.file">/ARCS/key.ser</prop>
	        <!-- Default server port to use. 22 is the SFTP default, but we use 8080 by default to avoid conflicts with general SSH usage-->
	        <prop key="sftp.port">8080</prop>
	        <!-- If don't include sftp.home.dir assumes directory containing this file-->
	        <!-- <prop key="sftp.home.dir">/ARCS</prop> -->
	        <!-- If don't include sftp.log.dir assumes /logs inside directory containing this file-->
	        <!-- <prop key="sftp.log.dir">/ARCS/logs</prop> -->
	        <!-- List of IP adresses to block -->
	        <!-- <prop key="ipv4.black.list">!127.0.0.1,!192.*.*.*</prop> -->
		    </props>
	    </constructor-arg>
	</bean>
	
	<bean id="cmdReader" class="au.org.arcs.griffin.parser.impl.FtpCmdReaderThread" singleton="false">
		<property name="parser" ref="parser" />
	</bean>

	<bean id="session" class="au.org.arcs.griffin.session.impl.FtpSessionImpl" singleton="false">
		<property name="cmdReader" ref="cmdReader" />
	</bean>

	<bean id="gridftpCommand" class="au.org.arcs.sftp.command.GridFTPCommand" singleton="false">
		<property name="cmdReader" ref="cmdReader" />
		<property name="options" ref="options" />
		<property name="resources" value="griffin-resources"/>
		<property name="fileSystem" ref="fileSystem" />
		<property name="ftpEventListener" ref="server" />
	</bean>
	
	<bean id="server" class="au.org.arcs.griffin.server.impl.GsiFtpServer" singleton="true">
		<property name="name" value="GSI FTP Server" />
		<property name="options" ref="options" />
		<property name="resources" value="griffin-resources"/>
		<property name="fileSystem" ref="fileSystem" />
		<property name="sshEnabled" value="true"/>
	</bean>
	
	<bean id="irodsConnectionManager"
		class="org.irods.jargon.core.connection.IRODSSimpleProtocolManager"
		factory-method="instance" init-method="initialize" destroy-method="destroy">
	</bean>
	<bean id="irodsSession"
		class="org.irods.jargon.core.connection.IRODSSession" factory-method="instance">
		<constructor-arg
			type="org.irods.jargon.core.connection.IRODSProtocolManager" ref="irodsConnectionManager" />
	</bean>
	<bean id="irodsAccessObjectFactory"
		class="org.irods.jargon.core.pub.IRODSAccessObjectFactoryImpl">
		<constructor-arg ref="irodsSession" />
	</bean>
 
	<bean id="fileSystem" class="au.org.arcs.griffin.filesystem.impl.jargon.JargonFileSystemImpl" singleton="true">
	    <property name="irodsSession" ref="irodsSession" />
	    <property name="irodsAccessObjectFactory" ref="irodsAccessObjectFactory" />
	    <property name="serverName" value="localhost" />
		<property name="serverPort" value="1247" />
		<property name="zoneName" value="testZone" />
		<!-- auth type: irods, pam, myproxy -->
		<property name="defaultAuthType" value="pam" />
		<property name="jargonInternalCacheBufferSize" value="512000" />
						<!-- if connecting to a slave, this is needed for irods2.3 and previous versions. -->
		<!-- 
		<property name="mapFile" value="irods-mapfile" />
		 -->
		<!-- update interval, default is 10 mins -->
		<!-- <property name="updateInterval" value="10" /> -->
		<!-- default resource can be specified here. if no default resource is specified, it will be decided by the rule engine. -->
		<!-- <property name="defaultResource" value="arcs-df.vpac.org" /> -->
		<!-- for myproxy auth
		<property name="myProxyServerHost" value="mp-ca.arcs.org.au" />
        <property name="myProxyServerPort" value="7512" />
		 -->
	</bean>
	
<!-- Config for local file system -->
<!-- 
	<bean id="fileSystem" class="au.org.arcs.griffin.filesystem.impl.localfs.LocalFileSystemImpl" singleton="true">
		<property name="rootPath" value="/data/testroot" />
		<property name="userManager" ref="userManager" />
	</bean>
	
	<bean id="userFileReader" class="au.org.arcs.griffin.usermanager.impl.XmlFileReader" singleton="true">
	</bean>

	<bean id="userManager" class="au.org.arcs.griffin.usermanager.impl.XmlFileUserManager" singleton="true">
		<property name="fileReader" ref="userFileReader"/>
	</bean>
-->
	
</beans>
